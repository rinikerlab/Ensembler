

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Free Energy Calculations &mdash; Ensembler beta documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Documentation" href="../_source/index.html" />
    <link rel="prev" title="Enhanced Sampling Simulations" href="Example_EnhancedSampling.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Ensembler
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Example_ConveyorBelt.html">Conveyor Belt TI - scheme</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_EDS.html">EDS Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_EnhancedSampling.html">Enhanced Sampling Simulations</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Free Energy Calculations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Benchmarking-parameters">Benchmarking parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Setting-up-a-System">Setting up a System</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Analyctical-Solution">Analyctical Solution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Free-Energy-Pertubation-Method-with-BAR/Zwanzig">Free Energy Pertubation Method with BAR/Zwanzig</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Sampling">Sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Analysis">Analysis</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Linear-Coupling-Method---Thermodynamic-Integration-(TI)">Linear Coupling Method - Thermodynamic Integration (TI)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">Sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#FEP-with-multiple-lambda-windows:">FEP with multiple lambda windows:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Exponentially-Coupled---Enveloping-Distribution-Sampling-(EDS)---BAR/RewightedFEP">Exponentially Coupled - Enveloping Distribution Sampling (EDS) - BAR/RewightedFEP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#FEP-EDS_Evaluation">FEP-EDS_Evaluation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#BAR-EDS_Evaluation">BAR-EDS_Evaluation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Hybrid-Methods---\lambda-EDS">Hybrid Methods - <span class="math notranslate nohighlight">\(\lambda\)</span>-EDS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Enhanced-Sampling-with-system-Coupling">Enhanced Sampling with system Coupling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Conveyor-Belt-TI">Conveyor Belt TI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#RE-EDS">RE-EDS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Final-Results">Final Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_source/index.html">Documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ensembler</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Examples</a> &raquo;</li>
        
      <li>Free Energy Calculations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Examples/Example_FreeEnergyCalculationSimulation.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Free-Energy-Calculations">
<h1>Free Energy Calculations<a class="headerlink" href="#Free-Energy-Calculations" title="Permalink to this headline">¶</a></h1>
<p>In this Notebook, we want to give a short glimpse on Free Energy Calculations with Ensembler.</p>
<p>Free energies are an very important topic in computational chemistry. As they are fundamental to thermodynamics and can give a lot of information for different changes to a system. Generally we can destinguish three types of free energies: thermodynamic, conformational and alchemical. The thermodynamic category is a free energy difference related to a change of an thermodynamic property of the system. The conformational free energy difference can be used to describe a conformational change of a
molecule (phase space areas) and the alchemical free energy is describing a change in the chemical space of the molecule (e.g.: methylation).</p>
<p>To calculate a free energy can be very tricky. Challenges might be sampling convergence due to high energy barriers or entropy differences.</p>
<p>To be able to estimate the influence of a chemical change, one needs to calculate the free energies of both so called states.</p>
<p>Here we calculate the Free Energy as:</p>
<p>$F_i = V_i - T_i S_i = -:nbsphinx-math:<a href="#id1"><span class="problematic" id="id2">`</span></a>beta <a href="#id3"><span class="problematic" id="id4">`</span></a>ln(Z_i) $</p>
<p>Or we can use the statistical approach:</p>
<p><span class="math notranslate nohighlight">\(F_i(t) = -\frac{1}{\beta} ln(\langle e^{-\beta H_i(t)}\rangle_i)\)</span></p>
<p>With the Gibbs Free Energy of state i and state J we can get the Free Energy Difference of the change.</p>
<p><span class="math notranslate nohighlight">\(\Delta F_{ij} = F_j - F_i = -\beta ln(\frac{Z_i}{Z_j})\)</span></p>
<p>This allows us to estimate the influence of the change.</p>
<p>A free energy Calculation can be described contains three parts: * The System: Normally these contian multiple states. * The Sampling Method: The way how the Free Energy landscape will be integrated. * The Free Energy Estimator: The way, the free energy will be derived from the simulation.</p>
<p>In this notebook we will cover following methods: * Free Energy Pertubation * Zwanzig * BAR * linear coupling * TI * exponential coupling * EDS * hybrid coupling * <span class="math notranslate nohighlight">\(\lambda\)</span>-EDS * Enhanced Sampling methods: * Conveyor Belt * RE-EDS</p>
<p>References: - a good page to learn about free energies: <a class="reference external" href="http://www.alchemistry.org">http://www.alchemistry.org</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Here some imports:</span>

<span class="c1">##System Path</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;/..&quot;</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c1">##basics</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1">##Ensembler</span>
<span class="kn">from</span> <span class="nn">ensembler.analysis.freeEnergyCalculation</span> <span class="kn">import</span> <span class="n">zwanzigEquation</span><span class="p">,</span> <span class="n">threeStateZwanzigReweighting</span><span class="p">,</span> <span class="n">bennetAcceptanceRatio</span>

<span class="kn">from</span> <span class="nn">ensembler.potentials</span> <span class="kn">import</span> <span class="n">OneD</span> <span class="k">as</span> <span class="n">pot</span>
<span class="kn">from</span> <span class="nn">ensembler.samplers.stochastic</span> <span class="kn">import</span> <span class="n">metropolisMonteCarloIntegrator</span><span class="p">,</span> <span class="n">langevinIntegrator</span>
<span class="kn">from</span> <span class="nn">ensembler.system.basic_system</span> <span class="kn">import</span> <span class="n">system</span>
<span class="kn">from</span> <span class="nn">ensembler.system.perturbed_system</span> <span class="kn">import</span> <span class="n">perturbedSystem</span>
<span class="kn">from</span> <span class="nn">ensembler.system.eds_system</span> <span class="kn">import</span> <span class="n">edsSystem</span>

<span class="kn">from</span> <span class="nn">ensembler.visualisation.plotSimulations</span> <span class="kn">import</span> <span class="n">oneD_simulation_analysis_plot</span>

<span class="kn">from</span> <span class="nn">ensembler.conditions.box_conditions</span> <span class="kn">import</span> <span class="n">periodicBoundaryCondition</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">ensembler.visualisation</span> <span class="kn">import</span> <span class="n">style</span>
<span class="kn">from</span> <span class="nn">ensembler.visualisation</span> <span class="kn">import</span> <span class="n">plot_layout_settings</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">plot_layout_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

</pre></div>
</div>
</div>
<div class="section" id="Benchmarking-parameters">
<h2>Benchmarking parameters<a class="headerlink" href="#Benchmarking-parameters" title="Permalink to this headline">¶</a></h2>
<p>Here we define some parameters that allow us an easier comparison of the different methods.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">simulation_steps_total_per_approach</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">space_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

</pre></div>
</div>
</div>
</div>
<div class="section" id="Setting-up-a-System">
<h2>Setting up a System<a class="headerlink" href="#Setting-up-a-System" title="Permalink to this headline">¶</a></h2>
<p>We are now going to Setup a system, for the Free Energy Calculations. For this Notebook, we want to keep it simple. Therefore two 1D-Harmonic Oscillators with different shifted minima and force constants shall be perfect for us. These two harmonic oscillators could for example describe the difference of types of bonds.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Build System</span>
<span class="c1">#System Parameters:</span>
<span class="n">yoff1</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">xoff1</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">force_constant</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">entropic_difference</span> <span class="o">=</span> <span class="n">k2</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1">#2 #0.5</span>
<span class="n">potential_difference</span> <span class="o">=</span> <span class="n">yoff2</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">phase_space_distance</span> <span class="o">=</span> <span class="n">xoff2</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1">#State Potentials</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">harmonicOscillatorPotential</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">k1</span><span class="p">,</span> <span class="n">x_shift</span><span class="o">=</span><span class="n">xoff1</span><span class="p">,</span> <span class="n">y_shift</span><span class="o">=</span><span class="n">yoff1</span><span class="p">)</span>
<span class="n">h2</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">harmonicOscillatorPotential</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">k2</span><span class="p">,</span> <span class="n">x_shift</span><span class="o">=</span><span class="n">xoff2</span><span class="p">,</span> <span class="n">y_shift</span><span class="o">=</span><span class="n">yoff2</span><span class="p">)</span>

<span class="c1">#Visualize</span>
<span class="kn">from</span> <span class="nn">ensembler.visualisation.plotPotentials</span> <span class="kn">import</span> <span class="n">multiState_overlays</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">multiState_overlays</span><span class="p">([</span><span class="n">h1</span><span class="p">,</span><span class="n">h2</span><span class="p">])</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">enes1</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
<span class="n">enes2</span> <span class="o">=</span> <span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">enes1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state A&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">enes2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state A&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Two State Problem&quot;</span><span class="p">)</span>
<span class="c1">#fig.tight_layout()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;2state_systems.png&quot;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_5_0.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_5_0.png" />
</div>
</div>
</div>
<div class="section" id="Analyctical-Solution">
<h2>Analyctical Solution<a class="headerlink" href="#Analyctical-Solution" title="Permalink to this headline">¶</a></h2>
<p>The Analytical solution for our problem can be calculated as follows:</p>
<p>Check Eq</p>
<div class="line-block">
<div class="line">Gibbs Energy:</div>
<div class="line">$ F_i = V_i - T_i S_i $</div>
</div>
<p>For a harmonic Oscillator the entropy term can be formulated as:</p>
<p><span class="math notranslate nohighlight">\(F_i = V_i - \frac{1}{\beta} log(\sqrt{\frac{2 \pi}{k_i \beta}})\)</span></p>
<p>The final free energy difference is:</p>
<p><span class="math notranslate nohighlight">\(\Delta F_{ij} = F_j - F_i\)</span></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Analytical Solution</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># beta is in kT</span>

<span class="n">G_1</span> <span class="o">=</span> <span class="n">yoff1</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">beta</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">k1</span><span class="o">*</span><span class="n">beta</span><span class="p">)))</span>
<span class="n">G_2</span> <span class="o">=</span> <span class="n">yoff2</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">beta</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">k2</span><span class="o">*</span><span class="n">beta</span><span class="p">)))</span>
<span class="n">dG_expected</span> <span class="o">=</span> <span class="n">G_2</span><span class="o">-</span><span class="n">G_1</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;expected dG: &quot;</span><span class="p">,</span> <span class="n">dG_expected</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
expected dG:  1.2746530721670273
</pre></div></div>
</div>
</div>
<div class="section" id="Free-Energy-Pertubation-Method-with-BAR/Zwanzig">
<h2>Free Energy Pertubation Method with BAR/Zwanzig<a class="headerlink" href="#Free-Energy-Pertubation-Method-with-BAR/Zwanzig" title="Permalink to this headline">¶</a></h2>
<p>In this Category of methods, each of the endstates will be simulated seperatley. Afterwards, the trajectories will be evaluated with the opposite state and afterwards the free energy will be evaluated.</p>
<div class="section" id="Sampling">
<h3>Sampling<a class="headerlink" href="#Sampling" title="Permalink to this headline">¶</a></h3>
<p>Now we build first the two systems and run the simulations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Simulate the two states:</span>
<span class="n">steps</span> <span class="o">=</span> <span class="n">simulation_steps_total_per_approach</span>
<span class="n">equilibration_steps</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1">##Build Systems</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">metropolisMonteCarloIntegrator</span><span class="p">()</span>
<span class="n">integrator2</span> <span class="o">=</span> <span class="n">metropolisMonteCarloIntegrator</span><span class="p">()</span>

<span class="n">system1</span> <span class="o">=</span> <span class="n">system</span><span class="p">(</span><span class="n">potential</span><span class="o">=</span><span class="n">h1</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">integrator</span><span class="p">)</span>
<span class="n">system2</span> <span class="o">=</span> <span class="n">system</span><span class="p">(</span><span class="n">potential</span><span class="o">=</span><span class="n">h2</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">integrator2</span><span class="p">)</span>

<span class="c1">##Simulate:</span>
<span class="n">system1</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
<span class="n">state1_traj</span> <span class="o">=</span> <span class="n">system1</span><span class="o">.</span><span class="n">trajectory</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">oneD_simulation_analysis_plot</span><span class="p">(</span><span class="n">system1</span><span class="p">,</span> <span class="n">limits_coordinate_space</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Simulation:  Simulation: 100%|██████████| 1000/1000 [00:09&lt;00:00, 108.19it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_9_1.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_9_1.png" />
</div>
</div>
</div>
<div class="section" id="Analysis">
<h3>Analysis<a class="headerlink" href="#Analysis" title="Permalink to this headline">¶</a></h3>
<div class="section" id="Zwanzig-Equation">
<h4>Zwanzig Equation<a class="headerlink" href="#Zwanzig-Equation" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">V1</span><span class="o">=</span><span class="n">state1_traj</span><span class="o">.</span><span class="n">total_potential_energy</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>
<span class="c1">#V2=state2_traj.totEnergy[equilibration_steps:]</span>
<span class="n">V2</span><span class="o">=</span><span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">state1_traj</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:])</span>


<span class="n">zwanz</span> <span class="o">=</span> <span class="n">zwanzigEquation</span><span class="p">(</span><span class="n">kT</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dF_zwanzig</span> <span class="o">=</span> <span class="n">zwanz</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">Vi</span><span class="o">=</span><span class="n">V1</span><span class="p">,</span> <span class="n">Vj</span><span class="o">=</span><span class="n">V2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Expected Result: &quot;</span><span class="p">,</span> <span class="n">dG_expected</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Zwanzig Result: &quot;</span><span class="p">,</span> <span class="n">dF_zwanzig</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Difference:&quot;</span><span class="p">,</span> <span class="n">dF_zwanzig</span> <span class="o">-</span> <span class="n">dG_expected</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Expected Result:  1.2746530721670273
Zwanzig Result:  -1.3350829012377377

Difference: -2.609735973404765
</pre></div></div>
</div>
</div>
<div class="section" id="Bennet-Acceptance-Ratio-(BAR)">
<h4>Bennet Acceptance Ratio (BAR)<a class="headerlink" href="#Bennet-Acceptance-Ratio-(BAR)" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Simulate the two states:</span>
<span class="n">steps</span> <span class="o">=</span> <span class="n">simulation_steps_total_per_approach</span><span class="o">//</span><span class="mi">2</span>
<span class="n">equilibration_steps</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1">##Build Systems</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">metropolisMonteCarloIntegrator</span><span class="p">()</span>
<span class="n">sampler2</span> <span class="o">=</span> <span class="n">metropolisMonteCarloIntegrator</span><span class="p">()</span>

<span class="n">system1</span> <span class="o">=</span> <span class="n">system</span><span class="p">(</span><span class="n">potential</span><span class="o">=</span><span class="n">h1</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">sampler</span><span class="p">)</span>
<span class="n">system2</span> <span class="o">=</span> <span class="n">system</span><span class="p">(</span><span class="n">potential</span><span class="o">=</span><span class="n">h2</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">sampler2</span><span class="p">)</span>

<span class="c1">##Simulate:</span>
<span class="n">system1</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">withdraw_traj</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init_system</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">state1_traj</span> <span class="o">=</span> <span class="n">system1</span><span class="o">.</span><span class="n">trajectory</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">oneD_simulation_analysis_plot</span><span class="p">(</span><span class="n">system1</span><span class="p">,</span> <span class="n">limits_coordinate_space</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">system2</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">withdraw_traj</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init_system</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">state2_traj</span> <span class="o">=</span> <span class="n">system2</span><span class="o">.</span><span class="n">trajectory</span>

<span class="c1">#visualize</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">oneD_simulation_analysis_plot</span><span class="p">(</span><span class="n">system2</span><span class="p">,</span> <span class="n">limits_coordinate_space</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Simulation:  Simulation: 100%|██████████| 500/500 [00:02&lt;00:00, 179.69it/s]
Simulation:  Simulation: 100%|██████████| 500/500 [00:03&lt;00:00, 163.89it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_13_1.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_13_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_13_2.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_13_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ensembler</span> <span class="kn">import</span> <span class="n">visualisation</span>

<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">visualisation</span><span class="o">.</span><span class="n">figsize_doubleColumn</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">ax</span><span class="p">])</span>
<span class="n">traj_pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">system1</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">system1</span><span class="o">.</span><span class="n">potential</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state A&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ene</span> <span class="o">=</span> <span class="n">system1</span><span class="o">.</span><span class="n">potential</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">traj_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">traj_pos</span><span class="p">,</span> <span class="n">ene</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;simulation state A&quot;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>

<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">traj_pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">system2</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">system2</span><span class="o">.</span><span class="n">potential</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state B&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ene</span> <span class="o">=</span> <span class="n">system2</span><span class="o">.</span><span class="n">potential</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">traj_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">traj_pos</span><span class="p">,</span> <span class="n">ene</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;simulation state B&quot;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$V/[kT]$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;FEP / BAR&quot;</span><span class="p">)</span>
<span class="c1">#ax[0].set_title(&quot;State 2&quot;)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;freeEnergyPertubation.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_14_0.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_14_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">#Sampling l1</span>
<span class="sd">V11=h1.ene(state1_traj.position)</span>
<span class="sd">V21=h2.ene(state1_traj.position)</span>

<span class="sd">#Sampling l2</span>
<span class="sd">V12=h1.ene(state2_traj.position)</span>
<span class="sd">V22=h2.ene(state2_traj.position)</span>

<span class="sd">w_fw = np.array(V21 - V11, dtype=np.float)</span>
<span class="sd">w_rv = np.array(V12 - V22, dtype=np.float)</span>

<span class="sd">(DeltaF, dDeltaF)=pymbar.BAR(w_F=w_fw, w_R=w_rv, DeltaF=0, method=&#39;bisection&#39;, verbose=False)</span>
<span class="sd">(DeltaF, dDeltaF)</span>


<span class="sd">print()</span>
<span class="sd">print(&quot;Expected Result: &quot;, dG_expected)</span>
<span class="sd">print(&quot;pymbar - BAR Result: &quot;, DeltaF)</span>
<span class="sd">print()</span>
<span class="sd">print(&quot;Difference:&quot;, DeltaF - dG_expected)</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;\n#Sampling l1\nV11=h1.ene(state1_traj.position)\nV21=h2.ene(state1_traj.position)\n\n#Sampling l2\nV12=h1.ene(state2_traj.position)\nV22=h2.ene(state2_traj.position)\n\nw_fw = np.array(V21 - V11, dtype=np.float)\nw_rv = np.array(V12 - V22, dtype=np.float)\n\n(DeltaF, dDeltaF)=pymbar.BAR(w_F=w_fw, w_R=w_rv, DeltaF=0, method=\&#39;bisection\&#39;, verbose=False)\n(DeltaF, dDeltaF)\n\n\nprint()\nprint(&#34;Expected Result: &#34;, dG_expected)\nprint(&#34;pymbar - BAR Result: &#34;, DeltaF)\nprint()\nprint(&#34;Difference:&#34;, DeltaF - dG_expected)\n&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Sampling l1</span>
<span class="n">V11</span><span class="o">=</span><span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">state1_traj</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
<span class="n">V21</span><span class="o">=</span><span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">state1_traj</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>

<span class="c1">#Sampling l2</span>
<span class="n">V12</span><span class="o">=</span><span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">state2_traj</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
<span class="n">V22</span><span class="o">=</span><span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">state2_traj</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>

<span class="n">bar</span> <span class="o">=</span> <span class="n">bennetAcceptanceRatio</span><span class="p">(</span><span class="n">kT</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dF_bar</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">Vj_i</span><span class="o">=</span><span class="n">V21</span><span class="p">,</span> <span class="n">Vi_i</span><span class="o">=</span><span class="n">V11</span><span class="p">,</span> <span class="n">Vi_j</span><span class="o">=</span><span class="n">V12</span><span class="p">,</span> <span class="n">Vj_j</span><span class="o">=</span><span class="n">V22</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Expected Result: &quot;</span><span class="p">,</span> <span class="n">dG_expected</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BAR Result: &quot;</span><span class="p">,</span> <span class="n">dF_bar</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Difference:&quot;</span><span class="p">,</span> <span class="n">dF_bar</span> <span class="o">-</span> <span class="n">dG_expected</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Iterate:        convergence raidus: 1e-05
Iteration: 0    dF: -1.486335934816872957679838480      convergence 1.486335934816872957679838480
Iteration: 1    dF: -2.512636697287688714527573571      convergence 1.026300762470815756847735091
Iteration: 2    dF: -3.225896286215770105550526260      convergence 0.713259588928081391022952689
Iteration: 3    dF: -3.730200928700198822986937190      convergence 0.504304642484428717436410930
Iteration: 4    dF: -4.093643158869150057714089382      convergence 0.363442230168951234727152192
Iteration: 5    dF: -4.360133980796929271868235901      convergence 0.266490821927779214154146519
Iteration: 6    dF: -4.558438704045752882753920805      convergence 0.198304723248823610885684904
Iteration: 7    dF: -4.707823638593249319966509011      convergence 0.149384934547496437212588206
Iteration: 8    dF: -4.821487558094169780224095953      convergence 0.113663919500920460257586942
Iteration: 9    dF: -4.908670861645307380542789178      convergence 0.087183303551137600318693225
Iteration: 10   dF: -4.975973586368922925833343399      convergence 0.067302724723615545290554221
Iteration: 11   dF: -5.028194627045952993878494410      convergence 0.052221040677030068045151011
Iteration: 12   dF: -5.068877380956397495691402285      convergence 0.040682753910444501812907875
Iteration: 13   dF: -5.100672443482417721615644489      convergence 0.031795062526020225924242204
Iteration: 14   dF: -5.125584090096038812821841549      convergence 0.024911646613621091206197060
Iteration: 15   dF: -5.145141372928773303736791265      convergence 0.019557282832734490914949716
Iteration: 16   dF: -5.160519246546328179158502016      convergence 0.015377873617554875421710751
Iteration: 17   dF: -5.172625852434198691760975941      convergence 0.012106605887870512602473925
Iteration: 18   dF: -5.182166409919772896848864272      convergence 0.009540557485574205087888331
Iteration: 19   dF: -5.189690622402519975173314612      convergence 0.007524212482747078324450340
Iteration: 20   dF: -5.195628261787385326380647216      convergence 0.005937639384865351207332604
Iteration: 21   dF: -5.200316140766050680268253339      convergence 0.004687878978665353887606123
Iteration: 22   dF: -5.204018723804496631391064898      convergence 0.003702583038445951122811559
Iteration: 23   dF: -5.206943982835990920163476176      convergence 0.002925259031494288772411278
Iteration: 24   dF: -5.209255661721184518953982338      convergence 0.002311678885193598790506162
Iteration: 25   dF: -5.211082805162762284386358721      convergence 0.001827143441577765432376383
Iteration: 26   dF: -5.212527188900476565284175759      convergence 0.001444383737714280897817038
Iteration: 27   dF: -5.213669130219732415996128136      convergence 0.001141941319255850711952377
Iteration: 28   dF: -5.214572042407293023105226296      convergence 0.000902912187560607109098160
Iteration: 29   dF: -5.215286011310301922238901792      convergence 0.000713968903008899133675496
Iteration: 30   dF: -5.215850608130695371121660303      convergence 0.000564596820393448882758511
Iteration: 31   dF: -5.216297104168168507083065854      convergence 0.000446496037473135961405551
Iteration: 32   dF: -5.216650216306790097183453516      convergence 0.000353112138621590100387662
Iteration: 33   dF: -5.216929483697380472147002106      convergence 0.000279267390590374963548590
Iteration: 34   dF: -5.217150354203637531879989074      convergence 0.000220870506257059732986968
Iteration: 35   dF: -5.217325042203347268487196506      convergence 0.000174687999709736607207432
Iteration: 36   dF: -5.217463206115751631473553975      convergence 0.000138163912404362986357469
Iteration: 37   dF: -5.217572483699002096408507492      convergence 0.000109277583250464934953517
Iteration: 38   dF: -5.217658915074164934792940781      convergence 0.000086431375162838384433289
Iteration: 39   dF: -5.217727277085916957976186735      convergence 0.000068362011752023183245954
Iteration: 40   dF: -5.217781347621954288945657890      convergence 0.000054070536037330969471155
Iteration: 41   dF: -5.217824114587470422089808228      convergence 0.000042766965516133144150338
Iteration: 42   dF: -5.217857941138350846740454562      convergence 0.000033826550880424650646334
Iteration: 43   dF: -5.217884696338234892794958659      convergence 0.000026755199884046054504097
Iteration: 44   dF: -5.217905858480664512699464730      convergence 0.000021162142429619904506071
Iteration: 45   dF: -5.217922596798802751636519915      convergence 0.000016738318138238937055185
Iteration: 46   dF: -5.217935836085830150268697945      convergence 0.000013239287027398632178030
Iteration: 47   dF: -5.217946307801649275924331243      convergence 0.000010471715819125655633298
Iteration: 48   dF: -5.217954590492847759867119960      convergence 0.000008282691198483942788717

Final Iterations:  48  Result:  -5.217954590492847759867119960

Expected Result:  1.2746530721670273
BAR Result:  -5.217954590492848

Difference: -6.492607662659875
</pre></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="Linear-Coupling-Method---Thermodynamic-Integration-(TI)">
<h2>Linear Coupling Method - Thermodynamic Integration (TI)<a class="headerlink" href="#Linear-Coupling-Method---Thermodynamic-Integration-(TI)" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id5">
<h3>Sampling<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Build Potential</span>
<span class="n">V_perturbed</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">linearCoupledPotentials</span><span class="p">(</span><span class="n">Va</span><span class="o">=</span><span class="n">h1</span><span class="p">,</span> <span class="n">Vb</span><span class="o">=</span><span class="n">h2</span><span class="p">)</span>

<span class="c1">#Visualize</span>
<span class="n">lambda_points</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">lambda_windows</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">lambda_points</span><span class="p">)</span>
<span class="k">for</span> <span class="n">lam</span> <span class="ow">in</span> <span class="n">lambda_windows</span><span class="p">:</span>
    <span class="n">V_perturbed</span><span class="o">.</span><span class="n">set_lambda</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>
    <span class="n">ene</span> <span class="o">=</span>  <span class="n">V_perturbed</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">ene</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;lam_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;V[kT]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Sampled Potentials&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Sampled Potentials&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_19_1.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_19_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">steps</span> <span class="o">=</span> <span class="n">simulation_steps_total_per_approach</span><span class="o">//</span><span class="n">lambda_points</span>
<span class="n">equilibration_steps</span> <span class="o">=</span> <span class="mi">30</span>

<span class="n">integrator</span> <span class="o">=</span> <span class="n">metropolisMonteCarloIntegrator</span><span class="p">()</span>
<span class="n">perturbed_system</span> <span class="o">=</span> <span class="n">perturbedSystem</span><span class="p">(</span><span class="n">potential</span><span class="o">=</span><span class="n">V_perturbed</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">integrator</span><span class="p">)</span>

<span class="n">system_trajs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">lam</span> <span class="ow">in</span> <span class="n">lambda_windows</span><span class="p">:</span>
    <span class="n">perturbed_system</span><span class="o">.</span><span class="n">set_lambda</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>
    <span class="n">perturbed_system</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">withdraw_traj</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init_system</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">system_trajs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">lam</span><span class="p">:</span> <span class="n">perturbed_system</span><span class="o">.</span><span class="n">trajectory</span><span class="p">})</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Simulation:  Simulation: 100%|██████████| 100/100 [00:00&lt;00:00, 138.49it/s]
Simulation:  Simulation: 100%|██████████| 100/100 [00:00&lt;00:00, 135.93it/s]
Simulation:  Simulation: 100%|██████████| 100/100 [00:00&lt;00:00, 117.91it/s]
Simulation:  Simulation: 100%|██████████| 100/100 [00:00&lt;00:00, 119.12it/s]
Simulation:  Simulation: 100%|██████████| 100/100 [00:00&lt;00:00, 157.56it/s]
Simulation:  Simulation: 100%|██████████| 100/100 [00:00&lt;00:00, 141.31it/s]
Simulation:  Simulation: 100%|██████████| 100/100 [00:00&lt;00:00, 139.80it/s]
Simulation:  Simulation: 100%|██████████| 100/100 [00:00&lt;00:00, 140.56it/s]
Simulation:  Simulation: 100%|██████████| 100/100 [00:00&lt;00:00, 147.53it/s]
Simulation:  Simulation: 100%|██████████| 100/100 [00:00&lt;00:00, 159.42it/s]
</pre></div></div>
</div>
</div>
<div class="section" id="id6">
<h3>Analysis<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="section" id="Exponential-Formula">
<h4>Exponential Formula<a class="headerlink" href="#Exponential-Formula" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ensembler</span> <span class="kn">import</span> <span class="n">visualisation</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="c1">#Visualize</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">visualisation</span><span class="o">.</span><span class="n">figsize_doubleColumn</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">axes</span><span class="p">])</span>
<span class="n">enes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">all_lams</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">system_trajs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">lamI</span> <span class="ow">in</span> <span class="n">all_lams</span><span class="p">:</span>
    <span class="n">trajI</span> <span class="o">=</span> <span class="n">system_trajs</span><span class="p">[</span><span class="n">lamI</span><span class="p">]</span>
    <span class="n">V_perturbed</span><span class="o">.</span><span class="n">set_lambda</span><span class="p">(</span><span class="n">lamI</span><span class="p">)</span>
    <span class="n">ene</span> <span class="o">=</span>  <span class="n">V_perturbed</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
    <span class="n">enes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ene</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lamI</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">lamI</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;binary&quot;</span><span class="p">)(</span><span class="n">lamI</span><span class="o">+</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">ene</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">trajI</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">V_perturbed</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">trajI</span><span class="o">.</span><span class="n">position</span><span class="p">),</span><span class="n">s</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$\lambda=$&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">lamI</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),)</span><span class="c1">#c=&quot;orange&quot;)</span>

<span class="n">logExp</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">enes</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_range</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;V[kT]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Linear Coupled Potentials&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>


<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;linear_coupled.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.0
0.1111111111111111
0.2222222222222222
0.3333333333333333
0.4444444444444444
0.5555555555555556
0.6666666666666666
0.7777777777777777
0.8888888888888888
1.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_22_1.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_22_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="FEP-with-multiple-lambda-windows:">
<h3>FEP with multiple lambda windows:<a class="headerlink" href="#FEP-with-multiple-lambda-windows:" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dA_i_fw</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">zwanz</span> <span class="o">=</span> <span class="n">zwanzigEquation</span><span class="p">()</span>
<span class="n">all_lams</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">system_trajs</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
<span class="k">for</span> <span class="n">lamI</span><span class="p">,</span> <span class="n">lamJ</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_lams</span><span class="p">,</span> <span class="n">all_lams</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
    <span class="n">trajI</span> <span class="o">=</span> <span class="n">system_trajs</span><span class="p">[</span><span class="n">lamI</span><span class="p">]</span>
    <span class="n">trajJ</span> <span class="o">=</span> <span class="n">system_trajs</span><span class="p">[</span><span class="n">lamJ</span><span class="p">]</span>

    <span class="n">Vi_fw</span> <span class="o">=</span> <span class="n">trajI</span><span class="o">.</span><span class="n">total_potential_energy</span>
    <span class="n">Vj_fw</span> <span class="o">=</span> <span class="n">trajJ</span><span class="o">.</span><span class="n">total_potential_energy</span>


    <span class="n">dF_zwanzig_fw</span> <span class="o">=</span> <span class="n">zwanz</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">Vi</span><span class="o">=</span><span class="n">Vi_fw</span><span class="p">,</span> <span class="n">Vj</span><span class="o">=</span><span class="n">Vj_fw</span><span class="p">)</span>

    <span class="n">dA_i_fw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dF_zwanzig_fw</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">visualisation</span><span class="o">.</span><span class="n">figsize_doubleColumn</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dA_i_fw</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$dFper lambda [kT]$&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$\lambda$&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;dF per lambda point&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">dF_FEP_10lambda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dA_i_fw</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Expected Result: &quot;</span><span class="p">,</span> <span class="n">dG_expected</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sum of intermediates Result: &quot;</span><span class="p">,</span> <span class="n">dF_FEP_10lambda</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Difference:&quot;</span><span class="p">,</span> <span class="n">dF_FEP_10lambda</span> <span class="o">-</span> <span class="n">dG_expected</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_24_0.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_24_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Expected Result:  1.2746530721670273
Sum of intermediates Result:  1.072022257355504

Difference: -0.20263081481152323
</pre></div></div>
</div>
<div class="section" id="Thermodynamic-Integration">
<h4>Thermodynamic Integration<a class="headerlink" href="#Thermodynamic-Integration" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">visualisation</span><span class="o">.</span><span class="n">figsize_doubleColumn</span><span class="p">)</span>

<span class="n">lam_stats</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">lam</span> <span class="ow">in</span> <span class="n">system_trajs</span><span class="p">:</span>
    <span class="n">lam_mean</span><span class="p">,</span> <span class="n">lam_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">system_trajs</span><span class="p">[</span><span class="n">lam</span><span class="p">]</span><span class="o">.</span><span class="n">dhdlam</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">system_trajs</span><span class="p">[</span><span class="n">lam</span><span class="p">]</span><span class="o">.</span><span class="n">dhdlam</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:])</span>
    <span class="n">lam_stats</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">lam</span><span class="p">:{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span><span class="n">lam_mean</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">lam_std</span><span class="p">}})</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="n">lam_mean</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="n">lam_mean</span><span class="p">,</span> <span class="n">lam_std</span><span class="p">)</span>

<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">lam_stats</span><span class="p">),</span> <span class="p">[</span><span class="n">lam_stats</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lam_stats</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$dH/d\lambda$&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$\lambda$&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;dH/d$\lambda$ for each Lambda point&quot;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 0.98, &#39;dH/d$\\lambda$ for each Lambda point&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_26_1.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_26_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>

<span class="n">lam</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">lam_stats</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="n">lam_stats</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lam</span><span class="p">]</span>
<span class="n">stds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lam_stats</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;std&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lam</span><span class="p">]</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dF_trapez</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lam</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">means</span><span class="p">)</span>
<span class="n">dF_err</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lam</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">stds</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Expected Result: &quot;</span><span class="p">,</span> <span class="n">dG_expected</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trapez Rule Result: &quot;</span><span class="p">,</span> <span class="n">dF_trapez</span><span class="p">,</span> <span class="s2">&quot;+-&quot;</span><span class="p">,</span> <span class="n">dF_err</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Difference:&quot;</span><span class="p">,</span> <span class="n">dF_trapez</span> <span class="o">-</span> <span class="n">dG_expected</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Expected Result:  1.2746530721670273
trapez Rule Result:  2.616859414457659 +- 6.5486799785247305

Difference: 1.3422063422906318
</pre></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="Exponentially-Coupled---Enveloping-Distribution-Sampling-(EDS)---BAR/RewightedFEP">
<h2>Exponentially Coupled - Enveloping Distribution Sampling (EDS) - BAR/RewightedFEP<a class="headerlink" href="#Exponentially-Coupled---Enveloping-Distribution-Sampling-(EDS)---BAR/RewightedFEP" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Build Potential</span>
<span class="n">s</span><span class="o">=</span><span class="mi">1</span>
<span class="n">Eoff</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">V_eds</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">envelopedPotential</span><span class="p">(</span><span class="n">V_is</span><span class="o">=</span><span class="p">[</span><span class="n">h1</span><span class="p">,</span><span class="n">h2</span><span class="p">]</span> <span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">eoff</span><span class="o">=</span><span class="n">Eoff</span><span class="p">)</span>
<span class="n">s_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>

<span class="c1">#Visualize</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s_values</span><span class="p">:</span>
    <span class="n">V_eds</span><span class="o">.</span><span class="n">s</span><span class="o">=</span><span class="n">s</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">V_eds</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$V_r=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;$&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state A&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state B&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

<span class="n">V_eds</span><span class="o">.</span><span class="n">s</span><span class="o">=</span><span class="mf">0.3</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;V[kT]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Sampled Potentials&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Sampled Potentials&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_30_1.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_30_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">steps</span> <span class="o">=</span> <span class="n">simulation_steps_total_per_approach</span>
<span class="n">equilibration_steps</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">good_s_value</span><span class="o">=</span><span class="mf">0.3</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">metropolisMonteCarloIntegrator</span><span class="p">()</span>
<span class="n">eds_system</span> <span class="o">=</span> <span class="n">edsSystem</span><span class="p">(</span><span class="n">potential</span><span class="o">=</span><span class="n">V_eds</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">integrator</span><span class="p">,</span> <span class="n">eds_s</span><span class="o">=</span><span class="n">good_s_value</span><span class="p">,</span> <span class="n">eds_Eoff</span><span class="o">=</span><span class="n">Eoff</span><span class="p">)</span>

<span class="n">eds_system</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">withdraw_traj</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init_system</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">eds_traj</span> <span class="o">=</span> <span class="n">eds_system</span><span class="o">.</span><span class="n">trajectory</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Simulation:  Simulation: 100%|██████████| 1000/1000 [00:07&lt;00:00, 139.08it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ensembler</span> <span class="kn">import</span> <span class="n">visualisation</span>

<span class="n">traj</span> <span class="o">=</span> <span class="n">eds_traj</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">h1_ene</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
<span class="n">h2_ene</span> <span class="o">=</span> <span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
<span class="n">V_eds</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">]</span>
<span class="n">eds_ene</span> <span class="o">=</span> <span class="n">V_eds</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>

<span class="n">traj_pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
<span class="n">traj_ene</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">total_potential_energy</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">visualisation</span><span class="o">.</span><span class="n">figsize_doubleColumn</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">ax</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">h1_ene</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state A&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">,)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">h2_ene</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state B&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">eds_ene</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;reference state&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">traj_pos</span><span class="p">,</span> <span class="n">traj_ene</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;simulation reference state&quot;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$V/[kT]$&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Exponential Coupling&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;EDS_sampling.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_32_0.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_32_0.png" />
</div>
</div>
<div class="section" id="FEP-EDS_Evaluation">
<h3>FEP-EDS_Evaluation<a class="headerlink" href="#FEP-EDS_Evaluation" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rew_zwanz</span> <span class="o">=</span> <span class="n">threeStateZwanzigReweighting</span><span class="p">(</span><span class="n">kT</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">traj_positions</span> <span class="o">=</span> <span class="n">eds_traj</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>
<span class="n">Vr</span> <span class="o">=</span> <span class="n">eds_traj</span><span class="o">.</span><span class="n">total_potential_energy</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>
<span class="n">V1</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">traj_positions</span><span class="p">)</span>
<span class="n">V2</span> <span class="o">=</span> <span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">traj_positions</span><span class="p">)</span>

<span class="n">dF_EDS</span> <span class="o">=</span> <span class="n">rew_zwanz</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">Vi</span><span class="o">=</span><span class="n">V1</span><span class="p">,</span> <span class="n">Vj</span><span class="o">=</span><span class="n">V2</span><span class="p">,</span> <span class="n">Vr</span><span class="o">=</span><span class="n">Vr</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dF &quot;</span><span class="p">,</span> <span class="n">dF_EDS</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;deviation: &quot;</span><span class="p">,</span> <span class="n">dF_EDS</span><span class="o">-</span><span class="n">dG_expected</span><span class="p">)</span>



</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dF  53.4647892340628
deviation:  52.19013616189577
</pre></div></div>
</div>
</div>
<div class="section" id="BAR-EDS_Evaluation">
<h3>BAR-EDS_Evaluation<a class="headerlink" href="#BAR-EDS_Evaluation" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">traj_positions = eds_traj.position[equilibration_steps:]</span>
<span class="sd">Vr = eds_traj.totEnergy[equilibration_steps:]</span>
<span class="sd">V1 = h1.ene(traj_positions)</span>
<span class="sd">V2 = h2.ene(traj_positions)</span>

<span class="sd">w_fw = np.array(V1 - Vr, dtype=np.float)</span>
<span class="sd">w_rv = np.array(V2 - Vr, dtype=np.float)</span>
<span class="sd">(DeltaF, dDeltaF)=pymbar.BAR(w_F=w_fw, w_R=w_rv, DeltaF=0, method=&#39;bisection&#39;, verbose=False)</span>
<span class="sd">print(&quot;dF_BAR:  &quot;, DeltaF)</span>
<span class="sd">print(&quot;deviation: &quot;, DeltaF-dG_expected)</span>

<span class="sd">&quot;&quot;&quot;</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;\n\ntraj_positions = eds_traj.position[equilibration_steps:]\nVr = eds_traj.totEnergy[equilibration_steps:]\nV1 = h1.ene(traj_positions)\nV2 = h2.ene(traj_positions)\n\nw_fw = np.array(V1 - Vr, dtype=np.float)\nw_rv = np.array(V2 - Vr, dtype=np.float)\n(DeltaF, dDeltaF)=pymbar.BAR(w_F=w_fw, w_R=w_rv, DeltaF=0, method=\&#39;bisection\&#39;, verbose=False)\nprint(&#34;dF_BAR:  &#34;, DeltaF)\nprint(&#34;deviation: &#34;, DeltaF-dG_expected)\n\n&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">traj_positions</span> <span class="o">=</span> <span class="n">eds_traj</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>
<span class="n">Vr</span> <span class="o">=</span> <span class="n">eds_traj</span><span class="o">.</span><span class="n">total_potential_energy</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>
<span class="n">V1</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">traj_positions</span><span class="p">)</span>
<span class="n">V2</span> <span class="o">=</span> <span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">traj_positions</span><span class="p">)</span>

<span class="n">bar</span> <span class="o">=</span> <span class="n">bennetAcceptanceRatio</span><span class="p">(</span><span class="n">kT</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dF_EDSbar</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">Vj_i</span><span class="o">=</span><span class="n">V1</span><span class="p">,</span> <span class="n">Vi_i</span><span class="o">=</span><span class="n">Vr</span><span class="p">,</span> <span class="n">Vi_j</span><span class="o">=</span><span class="n">V2</span><span class="p">,</span> <span class="n">Vj_j</span><span class="o">=</span><span class="n">Vr</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dF_BAR:  &quot;</span><span class="p">,</span> <span class="n">dF_EDSbar</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;deviation: &quot;</span><span class="p">,</span> <span class="n">dF_EDSbar</span><span class="o">-</span><span class="n">dG_expected</span><span class="p">)</span>




</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Iterate:        convergence raidus: 1e-05
Iteration: 0    dF: -2.041223901634211640388406963      convergence 2.041223901634211640388406963
Iteration: 1    dF: -2.471869055322535037972177390      convergence 0.430645153688323397583770427
Iteration: 2    dF: -2.650806890018568961665351751      convergence 0.178937834696033923693174361
Iteration: 3    dF: -2.731875010775685432445348797      convergence 0.081068120757116470779997046
Iteration: 4    dF: -2.769673733219445316559821349      convergence 0.037798722443759884114472552
Iteration: 5    dF: -2.787504125899849022045448196      convergence 0.017830392680403705485626847
Iteration: 6    dF: -2.795958403267316081244329765      convergence 0.008454277367467059198881569
Iteration: 7    dF: -2.799976470478891422983461450      convergence 0.004018067211575341739131685
Iteration: 8    dF: -2.801888249897718194725820361      convergence 0.001911779418826771742358911
Iteration: 9    dF: -2.802798341374748312336984886      convergence 0.000910091477030117611164525
Iteration: 10   dF: -2.803231692422988555573707267      convergence 0.000433351048240243236722381
Iteration: 11   dF: -2.803438062049216374613861105      convergence 0.000206369626227819040153838
Iteration: 12   dF: -2.803536344511851781612990902      convergence 0.000098282462635406999129797
Iteration: 13   dF: -2.803583152272376663365892712      convergence 0.000046807760524881752901810
Iteration: 14   dF: -2.803605445102723944827663726      convergence 0.000022292830347281461771014
Iteration: 15   dF: -2.803616062429519026725975171      convergence 0.000010617326795081898311445
Iteration: 16   dF: -2.803621119120444044202026636      convergence 0.000005056690925017476051465

Final Iterations:  16  Result:  -2.803621119120444044202026636
dF_BAR:   -2.803621119120444
deviation:  -4.078274191287472
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Hybrid-Methods---\lambda-EDS">
<h2>Hybrid Methods - <span class="math notranslate nohighlight">\(\lambda\)</span>-EDS<a class="headerlink" href="#Hybrid-Methods---\lambda-EDS" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Build Potential</span>
<span class="n">s</span><span class="o">=</span><span class="mi">1</span>
<span class="n">Eoff</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">V_hleds</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">lambdaEDSPotential</span><span class="p">(</span><span class="n">V_is</span><span class="o">=</span><span class="p">[</span><span class="n">h1</span><span class="p">,</span><span class="n">h2</span><span class="p">]</span> <span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">s_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>

<span class="c1">#Visualize</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>

<span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s_values</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">V_hleds</span><span class="o">.</span><span class="n">s</span><span class="o">=</span><span class="n">s</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">V_hleds</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$V_r=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;$&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state A&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state B&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;V[kT]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Sampled Potentials&quot;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0        100.0
1        1.0
2        0.5
3        0.3
4        0.2
5        0.1
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Sampled Potentials&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_39_2.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_39_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">14</span><span class="p">])</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
<span class="n">s_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>  <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
<span class="n">lams</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">7</span><span class="p">))))</span>


<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">s_values</span><span class="p">):</span>
    <span class="n">V_hleds</span><span class="o">.</span><span class="n">s</span><span class="o">=</span> <span class="n">s</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">lam</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lams</span><span class="p">):</span>
        <span class="n">V_hleds</span><span class="o">.</span><span class="n">lam</span><span class="o">=</span><span class="n">lam</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">V_hleds</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$\lambda=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;$&quot;</span><span class="p">)</span>

    <span class="c1">#ax.plot(positions,h1.ene(positions), label=&quot;state A&quot;, lw=1, color=&quot;grey&quot;, zorder=10)</span>
    <span class="c1">#ax.plot(positions,h2.ene(positions), label=&quot;state B&quot;, lw=1, color=&quot;black&quot;, zorder=10)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;V[kT]&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;s = &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_40_0.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_40_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#simulate</span>
<span class="n">steps</span> <span class="o">=</span> <span class="n">simulation_steps_total_per_approach</span>
<span class="n">equilibration_steps</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">integrator</span> <span class="o">=</span> <span class="n">metropolisMonteCarloIntegrator</span><span class="p">()</span>
<span class="n">hleds_system</span> <span class="o">=</span> <span class="n">edsSystem</span><span class="p">(</span><span class="n">potential</span><span class="o">=</span><span class="n">V_hleds</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">integrator</span><span class="p">,</span> <span class="n">eds_Eoff</span><span class="o">=</span><span class="n">Eoff</span><span class="p">)</span>

<span class="n">hleds_simulation_trajs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">good_s_value</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">hleds_system</span><span class="o">.</span><span class="n">set_s</span><span class="p">(</span><span class="n">good_s_value</span><span class="p">)</span>
<span class="n">hleds_system</span><span class="o">.</span><span class="n">potential</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">hleds_system</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">withdraw_traj</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init_system</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">hleds_simulation_traj</span> <span class="o">=</span> <span class="n">hleds_system</span><span class="o">.</span><span class="n">trajectory</span>

<span class="n">hleds_system</span><span class="o">.</span><span class="n">potential</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">hleds_system</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">withdraw_traj</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init_system</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">hleds_simulation_traj2</span> <span class="o">=</span> <span class="n">hleds_system</span><span class="o">.</span><span class="n">trajectory</span>


<span class="n">hleds_system</span><span class="o">.</span><span class="n">potential</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="mf">0.75</span>
<span class="n">hleds_system</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">withdraw_traj</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init_system</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">hleds_simulation_traj3</span> <span class="o">=</span> <span class="n">hleds_system</span><span class="o">.</span><span class="n">trajectory</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Simulation:  Simulation: 100%|██████████| 1000/1000 [00:08&lt;00:00, 115.33it/s]
Simulation:  Simulation: 100%|██████████| 1000/1000 [00:08&lt;00:00, 119.20it/s]
Simulation:  Simulation: 100%|██████████| 1000/1000 [00:08&lt;00:00, 120.40it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hleds_simulation_traj3</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Index([&#39;position&#39;, &#39;temperature&#39;, &#39;total_system_energy&#39;,
       &#39;total_potential_energy&#39;, &#39;total_kinetic_energy&#39;, &#39;dhdpos&#39;, &#39;velocity&#39;,
       &#39;s&#39;, &#39;eoff&#39;],
      dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ensembler</span> <span class="kn">import</span> <span class="n">visualisation</span>

<span class="n">traj</span> <span class="o">=</span> <span class="n">hleds_simulation_traj</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>
<span class="n">traj2</span> <span class="o">=</span> <span class="n">hleds_simulation_traj2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>
<span class="n">traj3</span> <span class="o">=</span> <span class="n">hleds_simulation_traj3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>

<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">h1_ene</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
<span class="n">h2_ene</span> <span class="o">=</span> <span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
<span class="n">V_hleds</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">]</span>

<span class="n">V_hleds</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">eds_ene</span> <span class="o">=</span> <span class="n">V_hleds</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
<span class="n">V_hleds</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">eds_ene1</span> <span class="o">=</span> <span class="n">V_hleds</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
<span class="n">V_hleds</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="mf">0.75</span>
<span class="n">eds_ene2</span> <span class="o">=</span> <span class="n">V_hleds</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>

<span class="n">traj_pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
<span class="n">traj_ene</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">total_potential_energy</span><span class="p">)</span>
<span class="n">traj_pos2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">traj2</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
<span class="n">traj_ene2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">traj2</span><span class="o">.</span><span class="n">total_potential_energy</span><span class="p">)</span>
<span class="n">traj_pos3</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">traj3</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
<span class="n">traj_ene3</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">traj3</span><span class="o">.</span><span class="n">total_potential_energy</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">visualisation</span><span class="o">.</span><span class="n">figsize_doubleColumn</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">ax</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">h1_ene</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state A&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">,)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">h2_ene</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state B&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">eds_ene</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;reference state, $\lambda$=0.5&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">eds_ene1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;reference state, $\lambda$=0.25&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">eds_ene2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;reference state, $\lambda$=0.75&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">traj_pos</span><span class="p">,</span> <span class="n">traj_ene</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;simulation reference state&quot;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">traj_pos2</span><span class="p">,</span> <span class="n">traj_ene2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;simulation reference state&quot;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">traj_pos3</span><span class="p">,</span> <span class="n">traj_ene3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;simulation reference state&quot;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$V/[kT]$&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;hybrid linear/exponential Coupling&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;hlEDS_sampling.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_43_0.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_43_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rew_zwanz</span> <span class="o">=</span> <span class="n">threeStateZwanzigReweighting</span><span class="p">(</span><span class="n">kT</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">zwanz</span> <span class="o">=</span> <span class="n">zwanzigEquation</span><span class="p">(</span><span class="n">kT</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">traj_positions</span> <span class="o">=</span> <span class="n">hleds_simulation_traj</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>
<span class="n">Vr</span> <span class="o">=</span> <span class="n">hleds_simulation_traj</span><span class="o">.</span><span class="n">total_potential_energy</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>
<span class="n">V1</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">traj_positions</span><span class="p">)</span>
<span class="n">V2</span> <span class="o">=</span> <span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">traj_positions</span><span class="p">)</span>

<span class="n">dF_leds</span> <span class="o">=</span> <span class="n">rew_zwanz</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">Vi</span><span class="o">=</span><span class="n">V1</span><span class="p">,</span> <span class="n">Vj</span><span class="o">=</span><span class="n">V2</span><span class="p">,</span> <span class="n">Vr</span><span class="o">=</span><span class="n">Vr</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dF &quot;</span><span class="p">,</span> <span class="n">dF_leds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;deviation: &quot;</span><span class="p">,</span> <span class="n">dF_leds</span><span class="o">-</span><span class="n">dG_expected</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dF  64.2830050885507
deviation:  63.00835201638367
</pre></div></div>
</div>
</div>
<div class="section" id="Enhanced-Sampling-with-system-Coupling">
<h2>Enhanced Sampling with system Coupling<a class="headerlink" href="#Enhanced-Sampling-with-system-Coupling" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Conveyor-Belt-TI">
<h3>Conveyor Belt TI<a class="headerlink" href="#Conveyor-Belt-TI" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">ensembler.ensemble.replicas_dynamic_parameters</span> <span class="k">as</span> <span class="nn">cvb</span>
<span class="kn">from</span> <span class="nn">ensembler.system</span> <span class="kn">import</span> <span class="n">perturbed_system</span>

<span class="c1">#CHEKC HERE H1 and H2 die</span>
<span class="n">equilibration_steps</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">numsys</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">V_perturbed</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">linearCoupledPotentials</span><span class="p">(</span><span class="n">Va</span><span class="o">=</span><span class="n">h1</span><span class="p">,</span> <span class="n">Vb</span><span class="o">=</span><span class="n">h2</span><span class="p">)</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">metropolisMonteCarloIntegrator</span><span class="p">()</span>

<span class="n">lam_system</span> <span class="o">=</span> <span class="n">perturbed_system</span><span class="o">.</span><span class="n">perturbedSystem</span><span class="p">(</span><span class="n">potential</span><span class="o">=</span><span class="n">V_perturbed</span> <span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">integrator</span><span class="p">)</span>
<span class="n">conveyorBelt</span><span class="o">=</span><span class="n">cvb</span><span class="o">.</span><span class="n">conveyorBelt</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">numsys</span><span class="p">,</span> <span class="n">system</span><span class="o">=</span><span class="n">lam_system</span><span class="p">,</span> <span class="n">build</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">conveyorBelt</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">simulation_steps_total_per_approach</span><span class="o">//</span><span class="n">numsys</span><span class="p">)</span>
<span class="n">cvb_trajs</span> <span class="o">=</span> <span class="n">conveyorBelt</span><span class="o">.</span><span class="n">get_trajectories</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e5c7e0e7fd304e1a89509d264f009e51", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">style</span><span class="o">.</span><span class="n">figsize_doubleColumn</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cvb_trajs</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cvb_trajs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">lam</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\lambda_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;$&quot;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>    <span class="n">axes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$time [steps]$&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Conveyor belt replica sampling&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_49_0.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_49_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">nbins</span><span class="o">=</span><span class="mi">50</span>
<span class="n">mega_traj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cvb_trajs</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">frequencies</span><span class="p">,</span> <span class="n">lam_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mega_traj</span><span class="o">.</span><span class="n">lam</span><span class="p">))),</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lam_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">nbins</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;BarContainer object of 50 artists&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_50_1.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_50_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">mega_traj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cvb_trajs</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">find_nearest_bin</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
    <span class="n">cbins</span> <span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">array</span><span class="o">-</span><span class="n">val</span><span class="p">))</span>
        <span class="n">cbins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cbins</span>

<span class="n">discrete_traj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">find_nearest_bin</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">mega_traj</span><span class="o">.</span><span class="n">lam</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:],</span> <span class="n">array</span><span class="o">=</span><span class="n">lam_bins</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
<span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mega_traj</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]),</span> <span class="n">mega_traj</span><span class="o">.</span><span class="n">total_potential_energy</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:],</span> <span class="n">c</span><span class="o">=</span><span class="n">discrete_traj</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;tab20&quot;</span><span class="p">)</span>

<span class="c1">#State Potentials</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">harmonicOscillatorPotential</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">k1</span><span class="p">,</span> <span class="n">x_shift</span><span class="o">=</span><span class="n">xoff1</span><span class="p">,</span> <span class="n">y_shift</span><span class="o">=</span><span class="n">yoff1</span><span class="p">)</span>
<span class="n">h2</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">harmonicOscillatorPotential</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">k2</span><span class="p">,</span> <span class="n">x_shift</span><span class="o">=</span><span class="n">xoff2</span><span class="p">,</span> <span class="n">y_shift</span><span class="o">=</span><span class="n">yoff2</span><span class="p">)</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state1&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state2&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;V[kT]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Conveyor Belt Sampling&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;CVB_sampling.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_51_0.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_51_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>

<span class="n">lambda_stat</span> <span class="o">=</span> <span class="n">mega_traj</span><span class="p">[[</span><span class="s2">&quot;lam&quot;</span><span class="p">,</span><span class="s2">&quot;dhdlam&quot;</span><span class="p">]]</span>

<span class="n">means_cvb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lambda_stat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">discrete_traj</span><span class="o">==</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">dhdlam</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbins</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
<span class="n">std_cvb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lambda_stat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">discrete_traj</span><span class="o">==</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">dhdlam</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbins</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">means_cvb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x191c2564a88&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_53_1.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_53_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dF_cvb_trapez</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lam_bins</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">means_cvb</span><span class="p">)</span>
<span class="n">dF_err</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">means_cvb</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">std_cvb</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Expected Result: &quot;</span><span class="p">,</span> <span class="n">dG_expected</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trapez Rule Result: &quot;</span><span class="p">,</span> <span class="n">dF_cvb_trapez</span><span class="p">,</span> <span class="s2">&quot;+-&quot;</span><span class="p">,</span> <span class="n">dF_err</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Difference:&quot;</span><span class="p">,</span> <span class="n">dF_cvb_trapez</span> <span class="o">-</span> <span class="n">dG_expected</span><span class="p">)</span>



</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Expected Result:  1.2746530721670273
trapez Rule Result:  5.353068268359306 +- -47.61145210334436

Difference: 4.078415196192278
</pre></div></div>
</div>
</div>
<div class="section" id="RE-EDS">
<h3>RE-EDS<a class="headerlink" href="#RE-EDS" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#potential</span>
<span class="n">Eoff</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">V_eds</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">envelopedPotential</span><span class="p">(</span><span class="n">V_is</span><span class="o">=</span><span class="p">[</span><span class="n">h1</span><span class="p">,</span><span class="n">h2</span><span class="p">])</span>

<span class="c1">##Integrator</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">metropolisMonteCarloIntegrator</span><span class="p">()</span>

<span class="c1">##System</span>
<span class="n">eds_system</span> <span class="o">=</span> <span class="n">edsSystem</span><span class="p">(</span><span class="n">sampler</span><span class="o">=</span><span class="n">integrator</span><span class="p">,</span> <span class="n">potential</span><span class="o">=</span><span class="n">V_eds</span><span class="p">,</span> <span class="n">start_position</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">eds_system</span><span class="o">.</span><span class="n">Eoff</span> <span class="o">=</span> <span class="n">Eoff</span>
<span class="nb">print</span><span class="p">(</span><span class="n">eds_system</span><span class="o">.</span><span class="n">potential</span><span class="o">.</span><span class="n">Eoff</span><span class="p">)</span>

<span class="c1">##Ensemble</span>
<span class="kn">from</span> <span class="nn">ensembler.ensemble</span> <span class="kn">import</span> <span class="n">replica_exchange</span>
<span class="c1">##Ensemble Settings:</span>
<span class="n">s_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">trials</span><span class="o">=</span><span class="mi">30</span>
<span class="n">steps_between_trials</span><span class="o">=</span><span class="n">simulation_steps_total_per_approach</span><span class="o">//</span><span class="p">(</span><span class="n">trials</span><span class="p">)</span> <span class="c1">#len(s_values)*</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DO trials: &quot;</span><span class="p">,</span> <span class="n">trials</span><span class="p">,</span> <span class="s2">&quot;steps: &quot;</span><span class="p">,</span> <span class="n">steps_between_trials</span><span class="p">)</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">replica_exchange</span><span class="o">.</span><span class="n">replicaExchangeEnvelopingDistributionSampling</span><span class="p">(</span><span class="n">system</span><span class="o">=</span><span class="n">eds_system</span><span class="p">,</span> <span class="n">exchange_criterium</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                                          <span class="n">s_range</span><span class="o">=</span><span class="n">s_values</span><span class="p">,</span> <span class="n">steps_between_trials</span><span class="o">=</span><span class="n">steps_between_trials</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">replica</span><span class="o">.</span><span class="n">s</span> <span class="k">for</span> <span class="n">repID</span><span class="p">,</span> <span class="n">replica</span> <span class="ow">in</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">replicas</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

<span class="c1">#State Potentials</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">harmonicOscillatorPotential</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">k1</span><span class="p">,</span> <span class="n">x_shift</span><span class="o">=</span><span class="n">xoff1</span><span class="p">,</span> <span class="n">y_shift</span><span class="o">=</span><span class="n">yoff1</span><span class="p">)</span>
<span class="n">h2</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">harmonicOscillatorPotential</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">k2</span><span class="p">,</span> <span class="n">x_shift</span><span class="o">=</span><span class="n">xoff2</span><span class="p">,</span> <span class="n">y_shift</span><span class="o">=</span><span class="n">yoff2</span><span class="p">)</span>

<span class="c1">#Visualize</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>

<span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">replica</span> <span class="ow">in</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">replicas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">replica</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">replica</span><span class="o">.</span><span class="n">potential</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">replica</span><span class="o">.</span><span class="n">potential</span><span class="o">.</span><span class="n">Eoff</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">replica</span><span class="o">.</span><span class="n">potential</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$replica &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;$&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state1&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;state2&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;V[kT]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Sampled Potentials&quot;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0, 0]
DO trials:  30 steps:  33
[1.0, 0.599484250318941, 0.35938136638046275, 0.2154434690031884, 0.1291549665014884, 0.0774263682681127, 0.046415888336127795, 0.02782559402207126, 0.016681005372000592, 0.01]
0        &lt;ensembler.system.eds_system.edsSystem object at 0x00000191C20EE888&gt;
[1.0, 1.0]
[0, 0]
1        &lt;ensembler.system.eds_system.edsSystem object at 0x00000191C2598C88&gt;
[0.599484250318941, 0.599484250318941]
[0, 0]
2        &lt;ensembler.system.eds_system.edsSystem object at 0x00000191C27E2388&gt;
[0.35938136638046275, 0.35938136638046275]
[0, 0]
3        &lt;ensembler.system.eds_system.edsSystem object at 0x00000191C2A914C8&gt;
[0.2154434690031884, 0.2154434690031884]
[0, 0]
4        &lt;ensembler.system.eds_system.edsSystem object at 0x00000191C1FB9808&gt;
[0.1291549665014884, 0.1291549665014884]
[0, 0]
5        &lt;ensembler.system.eds_system.edsSystem object at 0x00000191C2A69908&gt;
[0.0774263682681127, 0.0774263682681127]
[0, 0]
6        &lt;ensembler.system.eds_system.edsSystem object at 0x00000191C2A91D08&gt;
[0.046415888336127795, 0.046415888336127795]
[0, 0]
7        &lt;ensembler.system.eds_system.edsSystem object at 0x00000191C2AC1808&gt;
[0.02782559402207126, 0.02782559402207126]
[0, 0]
8        &lt;ensembler.system.eds_system.edsSystem object at 0x00000191C2A92348&gt;
[0.016681005372000592, 0.016681005372000592]
[0, 0]
9        &lt;ensembler.system.eds_system.edsSystem object at 0x00000191C2A933C8&gt;
[0.01, 0.01]
[0, 0]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Sampled Potentials&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_56_2.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_56_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ensemble</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">trials</span><span class="p">,</span> <span class="n">reset_ensemble</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">reeds_trajs</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">replica_trajectories</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Running trials: 100%|██████████| 30/30 [01:10&lt;00:00,  2.34s/it]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reeds_trajs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">style</span><span class="o">.</span><span class="n">figsize_doubleColumn</span><span class="p">)</span>
<span class="n">eqil</span><span class="o">=</span><span class="mi">100</span>
<span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">reeds_trajs</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">h1_ene</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
<span class="n">h2_ene</span> <span class="o">=</span> <span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">h1_ene</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">,)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">h2_ene</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>

<span class="k">for</span> <span class="n">traj</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span>  <span class="nb">round</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">replicas</span><span class="p">[</span><span class="n">traj</span><span class="p">]</span><span class="o">.</span><span class="n">s</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">replicas</span><span class="p">[</span><span class="n">traj</span><span class="p">]</span><span class="o">.</span><span class="n">potential</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">min_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">reeds_trajs</span><span class="p">[</span><span class="n">traj</span><span class="p">]</span><span class="o">.</span><span class="n">total_potential_energy</span><span class="p">[</span><span class="n">eqil</span><span class="p">:])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">reeds_trajs</span><span class="p">[</span><span class="n">traj</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">eqil</span><span class="p">:],</span> <span class="n">reeds_trajs</span><span class="p">[</span><span class="n">traj</span><span class="p">]</span><span class="o">.</span><span class="n">total_potential_energy</span><span class="p">[</span><span class="n">eqil</span><span class="p">:],</span> <span class="n">zorder</span><span class="o">=-</span><span class="n">traj</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">traj</span><span class="p">),</span><span class="n">s</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;replica s=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">6.5</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$V/[kT]$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;RE-EDS&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;REEDS.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_59_0.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_59_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">trajs</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">get_trajectories</span><span class="p">()</span>

<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">trajs</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
<span class="n">eqil</span><span class="o">=</span><span class="mi">100</span>
<span class="k">for</span> <span class="n">traj</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">reeds_trajs</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">reeds_trajs</span><span class="p">[</span><span class="n">traj</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">eqil</span><span class="p">:])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;replica&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">traj</span><span class="p">))</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_60_0.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_60_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
<span class="n">enes</span> <span class="o">=</span> <span class="p">[</span><span class="n">reeds_trajs</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">total_potential_energy</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">trajs</span><span class="p">)]</span>
<span class="n">min_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">enes</span><span class="p">)</span>
<span class="n">max_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">enes</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">ene</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">enes</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ene</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;replica&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">([</span><span class="n">steps_between_trials</span><span class="o">*</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">)],</span> <span class="n">ymin</span><span class="o">=</span><span class="n">min_e</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">max_e</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;exchange&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;replica potE timeseries&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">min_e</span><span class="p">,</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">max_e</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x191c0e29d48&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_61_1.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_61_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">stats</span><span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">exchange_information</span>
<span class="n">replicas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">exchange_information</span><span class="o">.</span><span class="n">replicaID</span><span class="p">)</span>
<span class="n">trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">exchange_information</span><span class="o">.</span><span class="n">nExchange</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">it</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>

<span class="n">replica_positions</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">replica</span> <span class="ow">in</span> <span class="n">replicas</span><span class="p">:</span>
    <span class="n">replica_positions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">replica</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stats</span><span class="o">.</span><span class="n">replicaID</span><span class="o">==</span><span class="n">replica</span><span class="p">]</span><span class="o">.</span><span class="n">replicaPositionI</span><span class="p">})</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">trials</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">replica_positions</span><span class="p">[</span><span class="n">replica</span><span class="p">]</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;replica_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">replica</span><span class="p">))</span>

<span class="c1">#plt.yticks(replicas+1, reversed(replicas+1))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">replicas</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">replicas</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;replica Positions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;trials&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Replica exchange transitions&quot;</span><span class="p">)</span>
<span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">replicas</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">):</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_62_0.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_62_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rew_zwanz</span> <span class="o">=</span> <span class="n">threeStateZwanzigReweighting</span><span class="p">(</span><span class="n">kT</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">zwanz</span> <span class="o">=</span> <span class="n">zwanzigEquation</span><span class="p">(</span><span class="n">kT</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">equilibration_steps</span><span class="o">=</span><span class="mi">10</span>
<span class="c1">#State Potentials</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">harmonicOscillatorPotential</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">k1</span><span class="p">,</span> <span class="n">x_shift</span><span class="o">=</span><span class="n">xoff1</span><span class="p">,</span> <span class="n">y_shift</span><span class="o">=</span><span class="n">yoff1</span><span class="p">)</span>
<span class="n">h2</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">harmonicOscillatorPotential</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">k2</span><span class="p">,</span> <span class="n">x_shift</span><span class="o">=</span><span class="n">xoff2</span><span class="p">,</span> <span class="n">y_shift</span><span class="o">=</span><span class="n">yoff2</span><span class="p">)</span>

<span class="n">dFresults</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">s_vals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reeds_trajs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="n">s_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reeds_trajs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">traj_positions</span> <span class="o">=</span> <span class="n">reeds_trajs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>
    <span class="n">Vr</span> <span class="o">=</span> <span class="n">reeds_trajs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">total_potential_energy</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>
    <span class="n">V1</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">traj_positions</span><span class="p">)</span>
    <span class="n">V2</span> <span class="o">=</span> <span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">traj_positions</span><span class="p">)</span>

    <span class="n">dFRew_zwanz</span> <span class="o">=</span> <span class="n">rew_zwanz</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">Vi</span><span class="o">=</span><span class="n">V1</span><span class="p">,</span> <span class="n">Vj</span><span class="o">=</span><span class="n">V2</span><span class="p">,</span> <span class="n">Vr</span><span class="o">=</span><span class="n">Vr</span><span class="p">)</span>

    <span class="n">dFresults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dFRew_zwanz</span><span class="p">)</span>

    <span class="n">df1</span> <span class="o">=</span> <span class="n">zwanz</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">Vi</span><span class="o">=</span><span class="n">V1</span><span class="p">,</span> <span class="n">Vj</span><span class="o">=</span><span class="n">V2</span><span class="p">)</span>
    <span class="n">df1r</span> <span class="o">=</span> <span class="n">zwanz</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">Vi</span><span class="o">=</span><span class="n">V1</span><span class="p">,</span> <span class="n">Vj</span><span class="o">=</span><span class="n">Vr</span><span class="p">)</span>
    <span class="n">df2r</span> <span class="o">=</span> <span class="n">zwanz</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">Vi</span><span class="o">=</span><span class="n">Vr</span><span class="p">,</span> <span class="n">Vj</span><span class="o">=</span><span class="n">V2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MAN &quot;</span><span class="p">,</span> <span class="n">df2r</span><span class="o">+</span><span class="n">df1r</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df1r</span><span class="p">,</span> <span class="n">df2r</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df1</span><span class="o">-</span><span class="n">dG_expected</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Replica &quot;</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;s: &quot;</span><span class="p">,</span><span class="n">reeds_trajs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dF_rew =  &quot;</span><span class="p">,</span> <span class="n">dFRew_zwanz</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Expected Result: &quot;</span><span class="p">,</span> <span class="n">dG_expected</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;s</span><span class="se">\t\t</span><span class="s2">dF</span><span class="se">\t\t</span><span class="s2">diff&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">5</span><span class="p">)))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>  <span class="nb">zip</span><span class="p">(</span><span class="n">s_vals</span><span class="p">,</span> <span class="n">dFresults</span><span class="p">,</span> <span class="n">dFresults</span> <span class="o">-</span> <span class="n">dG_expected</span><span class="p">)])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0 0
MAN  -1.6742351901982533
-3.053290670454073 -3.136384823010585 1.4621496328123318
-4.3279437426211
Replica  0
s:  1.0
dF_rew =   66.01648884154751
1 1
MAN  -1.8547196679704425
-3.1707704399968994 -3.441995682232946 1.5872760142625035
-4.445423512163927
Replica  1
s:  0.599484250318941
dF_rew =   58.6370244888642
2 2
MAN  -2.3067412895824138
-3.2496418311265725 -4.191809414440383 1.8850681248579686
-4.524294903293599
Replica  2
s:  0.35938136638046275
dF_rew =   58.925790640702864
3 3
MAN  -3.712737428147398
-3.443217131798358 -6.222677466298604 2.509940038151206
-4.7178702039653855
Replica  3
s:  0.2154434690031884
dF_rew =   54.44199975833901
4 4
MAN  -6.314675152703771
-3.579746347234042 -9.742699167331988 3.428024014628218
-4.854399419401069
Replica  4
s:  0.1291549665014884
dF_rew =   54.3730777812529
5 5
MAN  -10.19987779968984
-3.4690441108442367 -15.510679838960561 5.310802039270721
-4.743697183011264
Replica  5
s:  0.0774263682681127
dF_rew =   46.94032152029516
6 6
MAN  -17.235341937643483
-3.8285241526232716 -25.785929127697212 8.55058719005373
-5.103177224790299
Replica  6
s:  0.046415888336127795
dF_rew =   19.676160944837687
7 7
MAN  -27.858226718273407
-3.7203372024941403 -42.27093058541232 14.412703867138914
-4.994990274661168
Replica  7
s:  0.02782559402207126
dF_rew =   7.587814630505605
8 8
MAN  -45.64123679880576
-3.7451669163354513 -70.02027425516701 24.379037456361253
-5.019819988502478
Replica  8
s:  0.016681005372000592
dF_rew =   8.478552859604662
9 9
MAN  -27.256338424356386
-3.8179386471242167 -67.46658554719716 40.21024712284077
-5.092591719291244
Replica  9
s:  0.01
dF_rew =   2.4739761648625915

        Expected Result:  1.2746530721670273
s               dF              diff
1.0             66.01649                64.74184
0.59948         58.63702                57.36237
0.35938         58.92579                57.65114
0.21544         54.442          53.16735
0.12915         54.37308                53.09842
0.07743         46.94032                45.66567
0.04642         19.67616                18.40151
0.02783         7.58781         6.31316
0.01668         8.47855         7.2039
0.01            2.47398         1.19932




</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reeds_trajs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{0:                 position  temperature  total_system_energy  \
 0               -3.64762        298.0             8.894121
 1     -3.156745957492179        298.0             4.982523
 2     -3.511145344337173        298.0             6.164071
 3     -1.566615526741503        298.0             1.227142
 4     -1.655689159441235        298.0             1.370653
 ..                   ...          ...                  ...
 986  0.14455368840433813        298.0             0.009845
 987    2.631737256928324        298.0             0.820489
 988  -0.7486681018603276        298.0             0.280248
 989  0.02149190795372502        298.0            -0.000083
 990   2.4088950397702957        298.0             0.918226

      total_potential_energy  total_kinetic_energy                dhdpos  \
 0                  6.652561               2.24156    3.6476186940307187
 1                  4.982523                   NaN   0.49087273653854013
 2                  6.164071                   NaN  -0.35439938684499406
 3                  1.227142                   NaN      1.94452981759567
 4                  1.370653                   NaN  -0.08907363269973212
 ..                      ...                   ...                   ...
 986                0.009845                   NaN     1.689980959451713
 987                0.820489                   NaN     2.487183568523986
 988                0.280248                   NaN    -3.380405358788652
 989               -0.000083                   NaN    0.7701600098140526
 990                0.918226                   NaN    2.3874031318165705

                                        velocity         s    eoff
 0    [0.31619256151544384, -2.0935954107860235]  1.000000  [0, 0]
 1                                           NaN  1.000000  [0, 0]
 2                                           NaN  1.000000  [0, 0]
 3                                           NaN  1.000000  [0, 0]
 4                                           NaN  1.000000  [0, 0]
 ..                                          ...       ...     ...
 986                                         NaN  0.599484  [0, 0]
 987                                         NaN  0.599484  [0, 0]
 988                                         NaN  0.599484  [0, 0]
 989                                         NaN  0.599484  [0, 0]
 990                                         NaN  0.599484  [0, 0]

 [991 rows x 9 columns],
 1:                  position  temperature  total_system_energy  \
 0                 9.35812        298.0            45.556476
 1       7.991986833921553        298.0            31.901253
 2       6.608623471723669        298.0            19.904610
 3       5.496211762482864        298.0            10.252997
 4       5.551217931021305        298.0            10.663110
 ..                    ...          ...                  ...
 986    3.3427117448308623        298.0             1.164103
 987    1.4282767401793144        298.0             0.995212
 988   -1.9133248765189304        298.0             1.830406
 989    3.0593883249033595        298.0             0.980248
 990  -0.15643132375784852        298.0             0.012235

      total_potential_energy  total_kinetic_energy                dhdpos  \
 0                 43.787179              1.769297    -9.358339986870783
 1                 31.901253                   NaN   -1.3661344556950206
 2                 19.904610                   NaN   -1.3833633621978842
 3                 10.252997                   NaN   -1.1124117092408048
 4                 10.663110                   NaN   0.05500616853844065
 ..                      ...                   ...                   ...
 986                1.164103                   NaN  -0.09317992958680466
 987                0.995212                   NaN    -1.914435004651548
 988                1.830406                   NaN   -3.3416016166982447
 989                0.980248                   NaN      4.97271320142229
 990                0.012235                   NaN    -3.215819648661208

                                       velocity         s    eoff
 0    [-1.174076621639067, -1.4697408014161195]  0.599484  [0, 0]
 1                                          NaN  0.599484  [0, 0]
 2                                          NaN  0.599484  [0, 0]
 3                                          NaN  0.599484  [0, 0]
 4                                          NaN  0.599484  [0, 0]
 ..                                         ...       ...     ...
 986                                        NaN  1.000000  [0, 0]
 987                                        NaN  1.000000  [0, 0]
 988                                        NaN  1.000000  [0, 0]
 989                                        NaN  1.000000  [0, 0]
 990                                        NaN  1.000000  [0, 0]

 [991 rows x 9 columns],
 2:                  position  temperature  total_system_energy  \
 0                -6.45209        298.0            21.983042
 1     -1.8256063953171147        298.0             1.666407
 2      1.7712096584582575        298.0             0.360709
 3        2.02785834384915        298.0             0.302258
 4     0.16938685155098376        298.0            -0.011522
 ..                    ...          ...                  ...
 986    1.1577510664460218        298.0            -0.586839
 987    1.6667458678153992        298.0            -0.827907
 988  -0.15612797490179053        298.0            -0.135478
 989    -2.720369653050471        298.0             3.699993
 990    0.6350609577868243        298.0            -0.398975

      total_potential_energy  total_kinetic_energy               dhdpos  \
 0                 20.814759              1.168283   6.4520940455419336
 1                  1.666407                   NaN    4.626487650224819
 2                  0.360709                   NaN    3.596816053775372
 3                  0.302258                   NaN   0.2566486853908928
 4                 -0.011522                   NaN  -1.8584714922981664
 ..                      ...                   ...                  ...
 986               -0.586839                   NaN   0.3714007569132699
 987               -0.827907                   NaN   0.5089948013693774
 988               -0.135478                   NaN  -1.8228738427171898
 989                3.699993                   NaN  -2.5642416781486803
 990               -0.398975                   NaN    3.355430610837295

                                        velocity         s    eoff
 0    [-1.2473697867816218, -0.8835355432117847]  0.359381  [0, 0]
 1                                           NaN  0.359381  [0, 0]
 2                                           NaN  0.359381  [0, 0]
 3                                           NaN  0.359381  [0, 0]
 4                                           NaN  0.359381  [0, 0]
 ..                                          ...       ...     ...
 986                                         NaN  0.215443  [0, 0]
 987                                         NaN  0.215443  [0, 0]
 988                                         NaN  0.215443  [0, 0]
 989                                         NaN  0.215443  [0, 0]
 990                                         NaN  0.215443  [0, 0]

 [991 rows x 9 columns],
 3:                  position  temperature  total_system_energy  \
 0                -7.60407        298.0            30.033877
 1      -6.981895611518381        298.0            24.373433
 2     -2.6777232936306845        298.0             3.584859
 3      1.8878198937469222        298.0            -0.929595
 4     -0.5411006425754938        298.0             0.079747
 ..                    ...          ...                  ...
 986     3.176606385354002        298.0             0.453544
 987      2.38195479999675        298.0             0.205038
 988  -0.14283008607784886        298.0             0.000721
 989    2.5845449654164407        298.0             0.180523
 990   -1.4144239947911839        298.0             1.000221

      total_potential_energy  total_kinetic_energy               dhdpos  \
 0                 28.910968              1.122908    7.604073701619191
 1                 24.373433                   NaN   0.6221780900991747
 2                  3.584859                   NaN    4.304172317887696
 3                 -0.929595                   NaN    4.565543187377607
 4                  0.079747                   NaN   -2.428920536322416
 ..                      ...                   ...                  ...
 986                0.453544                   NaN    4.658889902807318
 987                0.205038                   NaN  -0.7946515853572522
 988                0.000721                   NaN   -2.524784886074599
 989                0.180523                   NaN   2.7273750514942896
 990                1.000221                   NaN  -3.9989689602076246

                                       velocity         s    eoff
 0    [1.4918703110236682, -0.1419138939607334]  0.215443  [0, 0]
 1                                          NaN  0.215443  [0, 0]
 2                                          NaN  0.215443  [0, 0]
 3                                          NaN  0.215443  [0, 0]
 4                                          NaN  0.215443  [0, 0]
 ..                                         ...       ...     ...
 986                                        NaN  0.359381  [0, 0]
 987                                        NaN  0.359381  [0, 0]
 988                                        NaN  0.359381  [0, 0]
 989                                        NaN  0.359381  [0, 0]
 990                                        NaN  0.359381  [0, 0]

 [991 rows x 9 columns],
 4:                position  temperature  total_system_energy  \
 0              -7.20965        298.0            29.483001
 1    -4.768829008960742        298.0            11.370618
 2    -2.249341840922956        298.0             2.484585
 3    -2.191632296998673        298.0             2.351696
 4    2.6390582043266404        298.0            -3.112049
 ..                  ...          ...                  ...
 986  0.8770503948532608        298.0            -5.399364
 987  0.8945056396560067        298.0            -5.429592
 988  3.7948586201046304        298.0            -4.643472
 989  2.0707909050803397        298.0            -6.732945
 990   1.906437930226107        298.0            -6.656033

      total_potential_energy  total_kinetic_energy                dhdpos  \
 0                 25.989537              3.493463     7.209652513094745
 1                 11.370618                   NaN     2.440822501623128
 2                  2.484585                   NaN    2.5194871680377857
 3                  2.351696                   NaN   0.05770954392428307
 4                 -3.112049                   NaN     4.830690501325313
 ..                      ...                   ...                   ...
 986               -5.399364                   NaN    0.2738913703102813
 987               -5.429592                   NaN   0.01745524480274596
 988               -4.643472                   NaN     2.900352980448624
 989               -6.732945                   NaN   -1.7240677150242907
 990               -6.656033                   NaN  -0.16435297485423273

                                      velocity         s    eoff
 0    [1.7777559172630453, 1.9561469206488955]  0.129155  [0, 0]
 1                                         NaN  0.129155  [0, 0]
 2                                         NaN  0.129155  [0, 0]
 3                                         NaN  0.129155  [0, 0]
 4                                         NaN  0.129155  [0, 0]
 ..                                        ...       ...     ...
 986                                       NaN  0.077426  [0, 0]
 987                                       NaN  0.077426  [0, 0]
 988                                       NaN  0.077426  [0, 0]
 989                                       NaN  0.077426  [0, 0]
 990                                       NaN  0.077426  [0, 0]

 [991 rows x 9 columns],
 5:                position  temperature  total_system_energy  \
 0               3.98397        298.0            -2.748754
 1    1.0138214380839656        298.0            -5.629553
 2    3.4929309620002877        298.0            -5.435821
 3     2.593275565734459        298.0            -6.690222
 4    2.7980635487301146        298.0            -6.543107
 ..                  ...          ...                  ...
 986   2.234352963037781        298.0            -3.185183
 987  0.4297353151894421        298.0            -1.618759
 988  1.0752022753538168        298.0            -2.362523
 989  2.4197793485336723        298.0            -3.183093
 990  0.8096580898288042        298.0            -2.064016

      total_potential_energy  total_kinetic_energy               dhdpos  \
 0                 -4.047061              1.298307  -3.3600102185458596
 1                 -5.629553                   NaN  -2.9701497845631284
 2                 -5.435821                   NaN    2.479109523916322
 3                 -6.690222                   NaN  -0.8996553962658288
 4                 -6.543107                   NaN   0.2047879829956556
 ..                      ...                   ...                  ...
 986               -3.185183                   NaN    0.577633754652046
 987               -1.618759                   NaN   -1.804617647848339
 988               -2.362523                   NaN   0.6454669601643748
 989               -3.183093                   NaN   1.3445770731798556
 990               -2.064016                   NaN   -1.610121258704868

                                      velocity         s    eoff
 0    [0.6336899143478687, 1.4815707647862706]  0.077426  [0, 0]
 1                                         NaN  0.077426  [0, 0]
 2                                         NaN  0.077426  [0, 0]
 3                                         NaN  0.077426  [0, 0]
 4                                         NaN  0.077426  [0, 0]
 ..                                        ...       ...     ...
 986                                       NaN  0.129155  [0, 0]
 987                                       NaN  0.129155  [0, 0]
 988                                       NaN  0.129155  [0, 0]
 989                                       NaN  0.129155  [0, 0]
 990                                       NaN  0.129155  [0, 0]

 [991 rows x 9 columns],
 6:                  position  temperature  total_system_energy  \
 0                 5.97001        298.0             1.515236
 1      3.7820014085302773        298.0           -10.557459
 2       3.085054855319467        298.0           -12.129985
 3      0.8221383837454272        298.0           -11.056110
 4      0.7646368351121436        298.0           -10.927669
 ..                    ...          ...                  ...
 986    1.4451166371062558        298.0           -22.119698
 987    0.8157646095414979        298.0           -20.878363
 988    3.6502900106378577        298.0           -20.849966
 989    0.5568346268430151        298.0           -20.189027
 990  -0.13093876136185967        298.0           -17.904184

      total_potential_energy  total_kinetic_energy                 dhdpos  \
 0                  1.017944              0.497292    -7.5621884361943295
 1                -10.557459                   NaN     -2.188011827185308
 2                -12.129985                   NaN    -0.6969465532108099
 3                -11.056110                   NaN      -2.26291647157404
 4                -10.927669                   NaN  -0.057501548633283606
 ..                      ...                   ...                    ...
 986              -22.119698                   NaN    -1.1433667161571548
 987              -20.878363                   NaN    -0.6293520275647579
 988              -20.849966                   NaN       2.83452540109636
 989              -20.189027                   NaN    -3.0934553837948426
 990              -17.904184                   NaN    -0.6877733882048748

                                       velocity         s    eoff
 0    [-0.5412803392336937, 0.8376160035408128]  0.046416  [0, 0]
 1                                          NaN  0.046416  [0, 0]
 2                                          NaN  0.046416  [0, 0]
 3                                          NaN  0.046416  [0, 0]
 4                                          NaN  0.046416  [0, 0]
 ..                                         ...       ...     ...
 986                                        NaN  0.027826  [0, 0]
 987                                        NaN  0.027826  [0, 0]
 988                                        NaN  0.027826  [0, 0]
 989                                        NaN  0.027826  [0, 0]
 990                                        NaN  0.027826  [0, 0]

 [991 rows x 9 columns],
 7:                  position  temperature  total_system_energy  \
 0                -3.07628        298.0            -2.118172
 1      0.9526103178854504        298.0           -21.201897
 2       2.111996171176722        298.0           -22.703881
 3    -0.07830079054344896        298.0           -18.100747
 4       4.675868603748983        298.0           -16.951724
 ..                    ...          ...                  ...
 986    2.4778915548988674        298.0           -12.709974
 987     3.365098908689922        298.0           -11.617766
 988     3.518707931735925        298.0           -11.268969
 989    1.2763058488099515        298.0           -11.922615
 990     2.859316451171522        298.0           -12.428853

      total_potential_energy  total_kinetic_energy               dhdpos  \
 0                 -2.929164              0.810991   5.9852749856241205
 1                -21.201897                   NaN    4.028887994407449
 2                -22.703881                   NaN   1.1593858532912715
 3                -18.100747                   NaN   -2.190296961720171
 4                -16.951724                   NaN    4.754169394292432
 ..                      ...                   ...                  ...
 986              -12.709974                   NaN   0.3322586551109058
 987              -11.617766                   NaN   0.8872073537910546
 988              -11.268969                   NaN    0.153609023046003
 989              -11.922615                   NaN  -2.2424020829259734
 990              -12.428853                   NaN   1.5830106023615709

                                       velocity         s    eoff
 0    [1.0541213768961726, -0.7147104903378106]  0.027826  [0, 0]
 1                                          NaN  0.027826  [0, 0]
 2                                          NaN  0.027826  [0, 0]
 3                                          NaN  0.027826  [0, 0]
 4                                          NaN  0.027826  [0, 0]
 ..                                         ...       ...     ...
 986                                        NaN  0.046416  [0, 0]
 987                                        NaN  0.046416  [0, 0]
 988                                        NaN  0.046416  [0, 0]
 989                                        NaN  0.046416  [0, 0]
 990                                        NaN  0.046416  [0, 0]

 [991 rows x 9 columns],
 8:                position  temperature  total_system_energy  \
 0               7.14251        298.0           -11.970533
 1     4.175378252418154        298.0           -35.724912
 2    1.4549211489368257        298.0           -38.759300
 3    0.5974632687759966        298.0           -36.821892
 4    3.3306497116571085        298.0           -38.237819
 ..                  ...          ...                  ...
 986   3.671667822022403        298.0           -65.138129
 987   2.930832830920217        298.0           -66.677195
 988   3.952352343613086        298.0           -64.266339
 989  3.8444937182913557        298.0           -64.620186
 990   1.074792902040239        298.0           -65.790831

      total_potential_energy  total_kinetic_energy                dhdpos  \
 0                -15.432067              3.461534    -9.757854651500828
 1                -35.724912                   NaN   -2.9671348107126914
 2                -38.759300                   NaN   -2.7204571034813285
 3                -36.821892                   NaN    -0.857457880160829
 4                -38.237819                   NaN     2.733186442881112
 ..                      ...                   ...                   ...
 986              -65.138129                   NaN     2.628517227631086
 987              -66.677195                   NaN   -0.7408349911021855
 988              -64.266339                   NaN     1.021519512692869
 989              -64.620186                   NaN  -0.10785862532173007
 990              -65.790831                   NaN   -2.7697008162511167

                                     velocity         s    eoff
 0    [1.277091930628838, -2.300457542655227]  0.016681  [0, 0]
 1                                        NaN  0.016681  [0, 0]
 2                                        NaN  0.016681  [0, 0]
 3                                        NaN  0.016681  [0, 0]
 4                                        NaN  0.016681  [0, 0]
 ..                                       ...       ...     ...
 986                                      NaN  0.010000  [0, 0]
 987                                      NaN  0.010000  [0, 0]
 988                                      NaN  0.010000  [0, 0]
 989                                      NaN  0.010000  [0, 0]
 990                                      NaN  0.010000  [0, 0]

 [991 rows x 9 columns],
 9:                 position  temperature  total_system_energy  \
 0               -6.14761        298.0           -10.201409
 1     -3.284007597170648        298.0           -40.215180
 2    -2.1608807328369206        298.0           -49.524003
 3     1.1989342336674018        298.0           -66.055590
 4     3.8296069984316077        298.0           -64.667176
 ..                   ...          ...                  ...
 986    3.899304750942719        298.0           -36.705914
 987    4.312947976541223        298.0           -35.177905
 988   2.1678730098921504        298.0           -39.359039
 989    1.512416584739754        298.0           -38.842578
 990    2.135340021635424        298.0           -39.352487

      total_potential_energy  total_kinetic_energy               dhdpos  \
 0                -10.436248              0.234839   11.561341737723232
 1                -40.215180                   NaN    2.863605245023697
 2                -49.524003                   NaN   1.1231268643337273
 3                -66.055590                   NaN   3.3598149665043224
 4                -64.667176                   NaN    2.630672764764206
 ..                      ...                   ...                  ...
 986              -36.705914                   NaN   2.3246579675955976
 987              -35.177905                   NaN   0.4136432255985045
 988              -39.359039                   NaN   -2.145074966649073
 989              -38.842578                   NaN  -0.6554564251523964
 990              -39.352487                   NaN   0.6229234368956699

                                       velocity         s    eoff
 0    [-0.6584947025158604, 0.1899009831161767]  0.010000  [0, 0]
 1                                          NaN  0.010000  [0, 0]
 2                                          NaN  0.010000  [0, 0]
 3                                          NaN  0.010000  [0, 0]
 4                                          NaN  0.010000  [0, 0]
 ..                                         ...       ...     ...
 986                                        NaN  0.016681  [0, 0]
 987                                        NaN  0.016681  [0, 0]
 988                                        NaN  0.016681  [0, 0]
 989                                        NaN  0.016681  [0, 0]
 990                                        NaN  0.016681  [0, 0]

 [991 rows x 9 columns]}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">reeds_trajs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">pairwise</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span><span class="n">keys</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

<span class="n">dF_1_path</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dF_2_path</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="ow">in</span> <span class="n">pairwise</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
    <span class="n">traj_s1</span> <span class="o">=</span> <span class="n">reeds_trajs</span><span class="p">[</span><span class="n">s1</span><span class="p">]</span>
    <span class="n">traj_s2</span> <span class="o">=</span> <span class="n">reeds_trajs</span><span class="p">[</span><span class="n">s2</span><span class="p">]</span>
    <span class="n">traj_s1_positions</span> <span class="o">=</span> <span class="n">traj_s1</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>
    <span class="n">traj_s2_positions</span> <span class="o">=</span> <span class="n">traj_s2</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">equilibration_steps</span><span class="p">:]</span>
    <span class="n">Vs1_1</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">traj_s1_positions</span><span class="p">)</span>
    <span class="n">Vs2_1</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">traj_s2_positions</span><span class="p">)</span>

    <span class="n">Vs1_2</span> <span class="o">=</span> <span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">traj_s1_positions</span><span class="p">)</span>
    <span class="n">Vs2_2</span> <span class="o">=</span> <span class="n">h2</span><span class="o">.</span><span class="n">ene</span><span class="p">(</span><span class="n">traj_s2_positions</span><span class="p">)</span>

    <span class="n">df1</span> <span class="o">=</span> <span class="n">zwanz</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">Vi</span><span class="o">=</span><span class="n">Vs1_1</span><span class="p">,</span> <span class="n">Vj</span><span class="o">=</span><span class="n">Vs2_1</span><span class="p">)</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">zwanz</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">Vi</span><span class="o">=</span><span class="n">Vs1_2</span><span class="p">,</span> <span class="n">Vj</span><span class="o">=</span><span class="n">Vs2_2</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">)</span>

    <span class="n">dF_1_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
    <span class="n">dF_2_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>

<span class="n">ddF_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dF_1_path</span><span class="p">)</span>
<span class="n">ddF_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dF_2_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0 1
-6.087363060779689 -74.08381511855208
1 2
-7.448471588194896 -69.36754448893993
2 3
-6.716401912862064 -66.94264386310483
3 4
-7.728420202934687 -65.66979272402563
4 5
-13.103059289218796 -67.17090783303672
5 6
-10.299307499510746 -69.9501553121141
6 7
-9.897479536482152 -48.97372613058822
7 8
-10.548451975695645 -28.74346669132713
8 9
-9.788373909545953 -22.779404580300863
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ddF_1</span><span class="p">,</span> <span class="n">ddF_2</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(-81.61732897522464, -513.6814567419895)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">([</span><span class="n">V1</span><span class="p">,</span> <span class="n">V2</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_67_0.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_67_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">traj_positions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([  3.,  18.,  77., 144., 188., 228., 181., 104.,  33.,   5.]),
 array([-1.7331488354429254, -0.974789508161551, -0.21643018088017651,
        0.5419291464011979, 1.3002884736825724, 2.058647800963947,
        2.8170071282453213, 3.575366455526696, 4.33372578280807,
        5.092085110089444, 5.850444437370819], dtype=object),
 &lt;a list of 10 Patch objects&gt;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_FreeEnergyCalculationSimulation_68_1.png" src="../_images/Examples_Example_FreeEnergyCalculationSimulation_68_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">rew_zwanz = threeStateZwanzigReweighting(kT=True)</span>
<span class="sd">equilibration_steps=10</span>
<span class="sd">#State Potentials</span>
<span class="sd">h1 = pot.harmonicOscillatorPotential(k=k1, x_shift=xoff1, y_shift=yoff1)</span>
<span class="sd">h2 = pot.harmonicOscillatorPotential(k=k2, x_shift=xoff2, y_shift=yoff2)</span>

<span class="sd">dFresults = []</span>
<span class="sd">s_vals = []</span>
<span class="sd">for ind,key in enumerate(reeds_trajs):</span>
<span class="sd">    s_vals.append(reeds_trajs[key].s[1])</span>
<span class="sd">    traj_positions = reeds_trajs[key].position[equilibration_steps:]</span>
<span class="sd">    Vr = reeds_trajs[key].totEnergy[equilibration_steps:]</span>
<span class="sd">    V1 = h1.ene(traj_positions)</span>
<span class="sd">    V2 = h2.ene(traj_positions)</span>

<span class="sd">    w_fw = np.array(V1 - Vr, dtype=np.float)</span>
<span class="sd">    w_rv = np.array(V2 - Vr, dtype=np.float)</span>

<span class="sd">    (DeltaF, dDeltaF)=pymbar.BAR(w_F=w_rv, w_R=-w_fw, DeltaF=0, method=&#39;bisection&#39;, verbose=False)</span>
<span class="sd">    dFresults.append(DeltaF)</span>


<span class="sd">print()</span>
<span class="sd">print(&quot;\tExpected Result: &quot;, dG_expected)</span>
<span class="sd">print(&quot;s\t\tdF\t\tdiff&quot;)</span>
<span class="sd">print(&quot;\n&quot;.join(map(str, [&quot;\t\t&quot;.join(map(str, np.round(x,5))) for x in  zip(s_vals, dFresults, dFresults - dG_expected)])))</span>
<span class="sd">print(&quot;\n\n\n&quot;)</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;\nrew_zwanz = threeStateZwanzigReweighting(kT=True)\nequilibration_steps=10\n#State Potentials\nh1 = pot.harmonicOscillatorPotential(k=k1, x_shift=xoff1, y_shift=yoff1) \nh2 = pot.harmonicOscillatorPotential(k=k2, x_shift=xoff2, y_shift=yoff2)\n\ndFresults = []\ns_vals = []\nfor ind,key in enumerate(reeds_trajs):\n    s_vals.append(reeds_trajs[key].s[1])\n    traj_positions = reeds_trajs[key].position[equilibration_steps:]\n    Vr = reeds_trajs[key].totEnergy[equilibration_steps:]\n    V1 = h1.ene(traj_positions)\n    V2 = h2.ene(traj_positions)\n\n    w_fw = np.array(V1 - Vr, dtype=np.float)\n    w_rv = np.array(V2 - Vr, dtype=np.float)\n\n    (DeltaF, dDeltaF)=pymbar.BAR(w_F=w_rv, w_R=-w_fw, DeltaF=0, method=\&#39;bisection\&#39;, verbose=False)\n    dFresults.append(DeltaF)\n\n    \nprint()\nprint(&#34;\tExpected Result: &#34;, dG_expected)\nprint(&#34;s\t\tdF\t\tdiff&#34;)\nprint(&#34;\n&#34;.join(map(str, [&#34;\t\t&#34;.join(map(str, np.round(x,5))) for x in  zip(s_vals, dFresults, dFresults - dG_expected)])))\nprint(&#34;\n\n\n&#34;)\n&#39;
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Final-Results">
<h2>Final Results<a class="headerlink" href="#Final-Results" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;analytical &quot;</span><span class="p">,</span><span class="n">dG_expected</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FEP &quot;</span><span class="p">,</span> <span class="n">dF_zwanzig</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BAR &quot;</span><span class="p">,</span> <span class="n">dF_bar</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FEP 10-lambda&quot;</span><span class="p">,</span><span class="n">dF_FEP_10lambda</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TI&quot;</span><span class="p">,</span> <span class="n">dF_trapez</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;EDS&quot;</span><span class="p">,</span> <span class="n">dF_EDS</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lEDS&quot;</span><span class="p">,</span> <span class="n">dF_leds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cvb&quot;</span><span class="p">,</span> <span class="n">dF_cvb_trapez</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;REEDS&quot;</span><span class="p">,</span> <span class="n">dFresults</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;EDS_BAR&quot;</span><span class="p">,</span> <span class="n">dF_EDSbar</span><span class="p">)</span>


</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
analytical  1.2746530721670273
FEP  -1.3350829012377377
BAR  -5.217954590492848
FEP 10-lambda 1.072022257355504
TI 2.616859414457659
EDS 53.4647892340628
lEDS 64.2830050885507
cvb 5.353068268359306
REEDS [66.01648884154751, 58.6370244888642, 58.925790640702864, 54.44199975833901, 54.3730777812529, 46.94032152029516, 19.676160944837687, 7.587814630505605, 8.478552859604662, 2.4739761648625915]
EDS_BAR -2.803621119120444
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../_source/index.html" class="btn btn-neutral float-right" title="Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Example_EnhancedSampling.html" class="btn btn-neutral float-left" title="Enhanced Sampling Simulations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Benjamin Ries, Stephanie Linker, David Hahn. Project structure based on the Computational Molecular Science Python Cookiecutter version 1.3

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>